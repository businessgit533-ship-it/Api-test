<?xml version="1.0" encoding="UTF-8"?>
<unload unload_date="2025-11-24 14:02:26">
<sys_remote_update_set action="INSERT_OR_UPDATE">
<application display_value="Global">global</application>
<application_name>Global</application_name>
<application_scope>global</application_scope>
<application_version/>
<collisions/>
<commit_date/>
<deleted/>
<description/>
<inserted/>
<name>Update Set 11-121</name>
<origin_sys_id/>
<parent/>
<release_date/>
<remote_base_update_set/>
<remote_parent_id/>
<remote_sys_id>07f591cf53d57a1013f55eb0a0490eb9</remote_sys_id>
<state>loaded</state>
<summary/>
<sys_class_name>sys_remote_update_set</sys_class_name>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2025-11-24 22:02:25</sys_created_on>
<sys_id>85014da753917e1013f55eb0a0490e4b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2025-11-24 22:02:25</sys_updated_on>
<update_set/>
<update_source/>
<updated/>
</sys_remote_update_set>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="Global">global</application>
<category>customer</category>
<comments/>
<name>sys_script_00df662253283210c36855e0a0490e9c</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update sys_domain="global" table="sys_script"&gt;&lt;sys_script action="INSERT_OR_UPDATE"&gt;&lt;abort_action&gt;false&lt;/abort_action&gt;&lt;access&gt;package_private&lt;/access&gt;&lt;action_delete&gt;false&lt;/action_delete&gt;&lt;action_insert&gt;false&lt;/action_insert&gt;&lt;action_query&gt;false&lt;/action_query&gt;&lt;action_update&gt;true&lt;/action_update&gt;&lt;active&gt;false&lt;/active&gt;&lt;add_message&gt;false&lt;/add_message&gt;&lt;advanced&gt;true&lt;/advanced&gt;&lt;change_fields&gt;false&lt;/change_fields&gt;&lt;client_callable&gt;false&lt;/client_callable&gt;&lt;collection&gt;sys_update_set&lt;/collection&gt;&lt;condition/&gt;&lt;description/&gt;&lt;execute_function&gt;false&lt;/execute_function&gt;&lt;filter_condition table="sys_update_set"&gt;stateCHANGESTOcomplete^EQ&lt;item display_value="Complete" endquery="false" field="state" goto="false" newquery="false" operator="CHANGESTO" or="false" value="complete"/&gt;&lt;item endquery="true" field="" goto="false" newquery="false" operator="=" or="false" value=""/&gt;&lt;/filter_condition&gt;&lt;is_rest&gt;false&lt;/is_rest&gt;&lt;message/&gt;&lt;name&gt;Push update set to Github&lt;/name&gt;&lt;order&gt;100&lt;/order&gt;&lt;priority&gt;100&lt;/priority&gt;&lt;rest_method/&gt;&lt;rest_method_text/&gt;&lt;rest_service/&gt;&lt;rest_service_text/&gt;&lt;rest_variables/&gt;&lt;role_conditions/&gt;&lt;script&gt;&lt;![CDATA[(function executeRule(current, previous /*null when async*/ ) {
    var attachmentFile = getAttachmentFromUpdateSet(current.sys_id);
    var request = new sn_ws.RESTMessageV2();
    request.setEndpoint('https://api.github.com/repos/businessgit533-ship-it/Api-test/contents/' + attachmentFile.updateSetName);
    request.setHttpMethod('PUT');

    //request.setRequestHeader('Authorization', '');
    request.setRequestHeader('User-Agent', 'ServiceNow-Integration');
    request.setRequestHeader('Accept', 'application/vnd.github.v3+json');

    var base64File = attachmentFile.content;
    var message = attachmentFile.message;

    var payload = {
        "message": message,
        "content": base64File
    };
    // gs.log(attachmentFile.updateSetName +"test");
    request.setRequestBody(JSON.stringify(payload));

    var response = request.execute();
    var status = response.getStatusCode();

    if (status == 201 || status == 200) {
        gs.info('File uploaded successfully.');
        var request2 = new sn_ws.RESTMessageV2();
        request2.setEndpoint('https://dev337184.service-now.com/api/1436129/importupdateset/getfile?file_name=' + attachmentFile.updateSetName);
        request2.setHttpMethod('GET');

        //Eg. UserName="admin", Password="admin" for this code sample.
        var user = 'admin';
        var password = 'H7aJe%h^sDQ0';

        request2.setBasicAuth(user, password);
        request2.setRequestHeader("Accept", "application/json");

        var response2 = request2.execute();
        gs.log(response2.getBody());

    } else {
        gs.error('Upload failed. Status: ' + status + ' | ' + response.getErrorMessage());
    }

    function getAttachmentFromUpdateSet(updateSetSysId) {
        var attachmentGR = new GlideRecord('sys_attachment');
        attachmentGR.addQuery('table_sys_id', updateSetSysId);
        attachmentGR.query();
        var attachmentName;
        if (attachmentGR.next()) {
            //     var attachmentSys_id = attachmentGR.getUniqueValue(); //attachmentGR.sys_id
                 attachmentName = attachmentGR.getValue('file_name');
            //     gs.info(attachmentName);
            //     var attachmentDocGR = new GlideRecord('sys_attachment_doc');
            //     attachmentDocGR.addQuery('sys_attachment', attachmentSys_id);
            //     attachmentDocGR.orderBy('position'); // in case file is split
            //     attachmentDocGR.query();

            //     var fileContent = '';
            //     while (attachmentDocGR.next()) {
            //         fileContent += attachmentDocGR.getValue('data');
            //         gs.info('fileContent /; ' + fileContent);

            //     }
            //     // Convert binary to base64
            //     var base64Content = GlideStringUtil.base64Encode(fileContent);





            //     gs.info('Payload ready: ' + JSON.stringify(payload));
            //     return payload;
            // } else {
            //     gs.error('No attachment found for Update Set: ' + updateSetSysId);
            //     return null;
            var gsu = (typeof GlideStringUtil != 'undefined') ? (GlideStringUtil) : (Packages.com.glide.util.StringUtil); //few versions support the first one, other supports second
            var gsa = (typeof GlideSysAttachment != 'undefined') ? (new GlideSysAttachment()) : (new Packages.com.glide.ui.SysAttachment());
            var attachmentData = gsa.getBytes(attachmentGR);
            var attachment = String(Packages.java.lang.String(attachmentData));
            // gs.info(attachment); //the data in the file will be printed as String
            var encData = GlideStringUtil.base64Encode(attachmentData); // data of one attachment at a time
            // gs.info(encData);
            var payload = {
                updateSetName: attachmentName,
                message: "Sending " + attachmentName + " attachment",
                content: encData
            };
            return payload;
        } else {
            gs.error('No attachment found for Update Set: ' + updateSetSysId);
            return null;

        }
    }
})(current, previous);]]&gt;&lt;/script&gt;&lt;sys_class_name&gt;sys_script&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2025-10-15 20:46:55&lt;/sys_created_on&gt;&lt;sys_domain&gt;global&lt;/sys_domain&gt;&lt;sys_domain_path&gt;/&lt;/sys_domain_path&gt;&lt;sys_id&gt;00df662253283210c36855e0a0490e9c&lt;/sys_id&gt;&lt;sys_mod_count&gt;31&lt;/sys_mod_count&gt;&lt;sys_name&gt;Push update set to Github&lt;/sys_name&gt;&lt;sys_overrides/&gt;&lt;sys_package display_value="Global" source="global"&gt;global&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;&lt;sys_update_name&gt;sys_script_00df662253283210c36855e0a0490e9c&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2025-11-18 17:45:19&lt;/sys_updated_on&gt;&lt;template/&gt;&lt;when&gt;before&lt;/when&gt;&lt;/sys_script&gt;&lt;sys_translated_text action="delete_multiple" query="documentkey=00df662253283210c36855e0a0490e9c"/&gt;&lt;/record_update&gt;</payload>
<payload_hash>409387255</payload_hash>
<remote_update_set display_value="Update Set 11-121">85014da753917e1013f55eb0a0490e4b</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2025-11-24 22:02:25</sys_created_on>
<sys_id>cd014da753917e1013f55eb0a0490e4b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>19ab0379ab40000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2025-11-24 22:02:25</sys_updated_on>
<table>sys_update_set</table>
<target_name>Push update set to Github</target_name>
<type>Business Rule</type>
<update_domain>global</update_domain>
<update_guid>5cac0d258451fe10fa17fe655aa6dcba</update_guid>
<update_guid_history>5cac0d258451fe10fa17fe655aa6dcba:409387255,5cac0d258451fe10fa17fe655aa6dcba:409387255,529cc9253151fe101638d44450a8a8eb:-157873026,d98c4925fc51fe10c3c5ddf48b668eb1:409387255,c37cc5255351fe10ba1349c993b238e9:-157873026,d75c8125f551fe104fe747d092d30a3a:409387255,7e23166b21053210b4c872d18e686058:-1358111533,d8a2922b1d053210a17f631da74a898f:-1447198863,bdf156a781053210123fe49ccc90a9b9:2122208155,01405ae3f3053210b1700e2371916466:1258231640,0e764a2339c13210ae2ebf94031d42ca:1043645617,abd3ce2bc78132107d3b75756f97790d:-354200310,0806f56f8b01321039126c73e5c3052b:1795299531,c9f53d2351413210951f61e93a4e66ec:1491173956,97d3f12fd6013210d39fe545b09e30ec:2104935670</update_guid_history>
<update_set/>
<view/>
</sys_update_xml>
</unload>